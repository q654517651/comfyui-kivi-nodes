{
  "LoopDetectExtract": {
    "display_name": "🔁 循环检测与提取",
    "description": "**循环检测与提取节点**\n\n使用先进的 FFT 自相关分析自动检测视频帧序列中的循环模式。\n\n**核心功能：**\n• GPU 加速处理，自动内存管理\n• 接缝检测，识别整段循环视频（首尾帧匹配）\n• 基于运动的评分，抑制微循环误检\n• 多因素周期选择，优先选择长周期\n• 稳健置信度评分，使用 IQR 统计\n\n**应用场景：**\n• 从长视频中提取完美循环片段\n• 检测动画循环\n• 查找重复运动模式\n• 优化循环起点实现无缝播放\n\n**输出内容：**\n• 边界优化的循环片段\n• 详细的分析报告和置信度分数",
    "inputs": {
      "frames": {
        "name": "输入帧序列",
        "tooltip": "**输入图像序列**，ComfyUI IMAGE 格式。\n\n• 格式：(batch, height, width, channels)\n• 值范围：[0, 1]（浮点数）\n• 最少：需要 2 帧\n• 推荐：30+ 帧以获得可靠检测"
      },
      "confidence_threshold": {
        "name": "置信度阈值",
        "tooltip": "**接受检测到的循环的最低置信度分数**\n\n• 范围：0.0 - 1.0\n• 默认：0.55（平衡）\n• 较低（0.3-0.4）：接受较弱的模式\n• 较高（0.6-0.8）：需要更强的证据\n• 低于阈值时返回所有帧不变\n\n**解读：**\n• 0.3-0.4：良好循环（轻微瑕疵）\n• 0.4-0.5：优秀循环（高质量）\n• 0.5+：完美循环（罕见）"
      },
      "min_period": {
        "name": "最小周期",
        "tooltip": "**最小循环周期（帧数）**\n\n• 默认：24 帧（24fps 时约 1 秒）\n• 防止检测到微循环（例如 2-8 帧抖动）\n• 根据内容调整：\n  - 快速动作：15-20 帧\n  - 正常运动：24-40 帧\n  - 慢速动画：40-60 帧"
      },
      "max_period": {
        "name": "最大周期",
        "tooltip": "**最大循环周期（帧数）**\n\n• 默认：300 帧（24fps 时约 12 秒）\n• 应小于总帧数\n• 值越大处理越慢\n• 推荐：N/2，其中 N 为总帧数"
      },
      "analysis_stride": {
        "name": "分析步长",
        "tooltip": "**分析时的帧采样步长**\n\n• 默认：2（每隔一帧分析）\n• 范围：1-8\n• 较低 = 更准确，更慢\n• 较高 = 更快，精度降低\n\n**推荐值：**\n• 1：最高精度（慢）\n• 2：良好平衡（推荐）\n• 4：快速预览模式\n• 8：非常快，粗略估计"
      },
      "analysis_size": {
        "name": "分析尺寸",
        "tooltip": "**分析时的目标分辨率**\n\n• 默认：256px\n• 帧会缩放到此尺寸以加快速度\n• 不影响输出质量\n• 越高越准确但越慢\n\n**推荐值：**\n• 128：非常快，可能遗漏细节\n• 256：良好平衡（推荐）\n• 384：高精度\n• 512：最大细节（慢）"
      },
      "seam_threshold": {
        "name": "接缝阈值",
        "tooltip": "**首尾帧相似度阈值**\n\n• 范围：0.0 - 1.0\n• 默认：0.85（严格）\n• 超过此值时触发整段循环检测\n\n**使用场景：**\n检测整个序列形成一个循环的视频（例如 122 帧旋转动画）。\n\n• 0.80：更宽松（允许轻微差异）\n• 0.85：平衡（推荐）\n• 0.90：严格（需要近乎完美匹配）"
      },
      "min_pairs": {
        "name": "最小样本对数",
        "tooltip": "**统计可靠性所需的最小样本对数**\n\n• 默认：12\n• 过滤数据不足的周期\n• 越高越保守，拒绝不稳定的候选\n\n**公式：** 样本对数 = N - 周期\n• 短视频：8-10\n• 普通视频：12-16\n• 长视频：20-24"
      },
      "prefer_longer_cycles": {
        "name": "优先长周期",
        "tooltip": "**分数接近时优先选择较长周期**\n\n• 默认：True（启用）\n• 有助于避免微循环误检\n• 当分数差异 < 5% 时，选择较长周期\n\n**示例：**\n• 8 帧微抖动：分数 = 0.30\n• 90 帧真实循环：分数 = 0.28\n→ 启用此选项后，选择 90 帧循环"
      },
      "length_bias": {
        "name": "长度偏好强度",
        "tooltip": "**对较长周期的偏好强度**\n\n• 范围：0.0 - 0.2\n• 默认：0.05（轻微）\n• 为较长周期的分数添加小额奖励\n\n• 0.00：无偏好（纯分数）\n• 0.05：轻微偏好（推荐）\n• 0.10：中等偏好\n• 0.15+：强偏好（可能错过短循环）"
      },
      "motion_weight": {
        "name": "运动权重",
        "tooltip": "**运动周期性在评分中的权重**\n\n• 范围：0.0 - 1.0\n• 默认：0.25（25% 运动，75% 外观）\n• 抑制静态或微运动的假循环\n\n**工作原理：**\n分析帧间运动能量：\n• 高运动周期性 = 真实循环\n• 低运动 = 静态或抖动\n\n• 0.0：仅外观（忽略运动）\n• 0.25：平衡（推荐）\n• 0.5：相等权重\n• 0.75+：运动主导"
      }
    },
    "outputs": {
      "0": {
        "name": "循环帧",
        "tooltip": "**检测到的循环片段**\n\n• 优化的循环边界\n• 可直接用于循环播放\n• 如果未检测到循环，返回所有输入帧"
      },
      "1": {
        "name": "循环起点",
        "tooltip": "**循环的起始帧索引**\n\n• 从零开始的索引\n• 0 = 循环从第一帧开始\n• 已优化以最小化接缝可见性"
      },
      "2": {
        "name": "循环周期",
        "tooltip": "**循环的长度（帧数）**\n\n• 检测到的循环中的帧数\n• 如果未检测到循环则等于总帧数\n• 用于时间计算（例如 周期/fps = 循环时长）"
      },
      "3": {
        "name": "置信度",
        "tooltip": "**循环检测置信度分数**\n\n• 范围：0.0 - 1.0\n• 越高 = 检测到的循环模式越强\n\n**解读：**\n• < 0.3：弱循环或无循环\n• 0.3-0.4：良好循环\n• 0.4-0.5：优秀循环\n• 0.5+：完美循环\n• 0.0：未检测到循环（低于阈值）"
      },
      "4": {
        "name": "分析报告",
        "tooltip": "**详细分析报告（文本）**\n\n包含内容：\n• 检测状态和置信度\n• 循环边界（起点、周期、终点）\n• 候选周期及其分数\n• 失败原因（如果未检测到）\n• 接缝检测信息（如果适用）\n\n用途：\n• 调试检测问题\n• 理解候选选择\n• 调整参数"
      }
    }
  },
  "VideoFrameExtractor": {
    "display_name": "📹 视频帧提取器",
    "description": "**视频帧提取器节点**\n\n提取视频首尾帧并颠倒顺序，生成 VAE 蒙版和遮罩视频。\n\n**核心功能：**\n• 提取首尾交叉段（颠倒顺序）\n• 生成连续白色蒙版区域（需要VAE重建）\n• 支持丢弃首尾帧让VAE重建\n• 自定义填充颜色\n\n**应用场景：**\n• 配合交叉溶解优化循环视频\n• VAE视频帧重建\n• 视频首尾过渡优化",
    "inputs": {
      "frames": {
        "name": "输入帧序列",
        "tooltip": "**输入图像序列**，ComfyUI IMAGE 格式。\n\n• 格式：(batch, height, width, channels)\n• 值范围：[0, 1]（浮点数）"
      },
      "crossfade_frames": {
        "name": "交叉溶解帧数",
        "tooltip": "**首尾各提取用于交叉溶解的帧数**\n\n• 默认：10\n• 范围：0-1000\n• 输出时颠倒顺序（尾在前，头在后）"
      },
      "mask_frames": {
        "name": "蒙版区帧数",
        "tooltip": "**中间蒙版区的帧数**\n\n• 默认：0\n• 范围：0-1000\n• 填充灰色，标记为需要VAE重建"
      },
      "discard_frames": {
        "name": "丢弃帧数",
        "tooltip": "**从 crossfade 段两端"吃掉"的帧数**\n\n• 默认：0\n• 范围：0-1000\n• 从 crossfade_frames 的两端去除\n• 实际原视频帧数 = crossfade - discard\n• 被丢弃的部分填充灰色让VAE重建"
      },
      "fill_color": {
        "name": "填充颜色",
        "tooltip": "**填充颜色（十六进制）**\n\n• 默认：#7F7F7F（中灰色）\n• 格式：#RRGGBB\n• 用于填充丢弃区和蒙版区"
      }
    },
    "outputs": {
      "0": {
        "name": "头部交叉帧",
        "tooltip": "**头部交叉段 (b)**（原视频）\n\n• 数量：crossfade_frames\n• 用于交叉溶解"
      },
      "1": {
        "name": "尾部交叉帧",
        "tooltip": "**尾部交叉段 (d)**（原视频）\n\n• 数量：crossfade_frames\n• 用于交叉溶解"
      },
      "2": {
        "name": "中间段",
        "tooltip": "**中间部分 (c)**（原视频）\n\n• 不包含在mask和masked_video中\n• 原始视频的中间段"
      },
      "3": {
        "name": "蒙版",
        "tooltip": "**VAE 蒙版**\n\n• 顺序：d + e + mask + a + b\n• 黑色 (0.0)：d和b（保留）\n• 白色 (1.0)：e+mask+a（连续重建区）\n• 形状：(N, H, W)"
      },
      "4": {
        "name": "遮罩视频",
        "tooltip": "**VAE 输入视频**\n\n• 顺序：d + e + mask + a + b\n• 原视频：d和b\n• 灰色：e+mask+a（连续填充区）\n• 形状：(N, H, W, 3)"
      }
    }
  },
  "LoopVideoCrossfade": {
    "display_name": "🔄 循环视频交叉溶解",
    "description": "**循环视频交叉溶解节点**\n\n通过交叉溶解技术无缝拼接两个视频，使输出本身也能循环播放。\n\n**核心功能：**\n• 智能分解和重组视频片段\n• 平滑的交叉溶解过渡\n• 输出可无缝循环\n\n**应用场景：**\n• 拼接循环视频片段\n• 消除循环接缝\n• 创建无限循环动画",
    "inputs": {
      "video1": {
        "name": "视频1",
        "tooltip": "**第一个视频序列**\n\n• 格式：ComfyUI IMAGE\n• 需要至少 crossfade_frames × 2 帧"
      },
      "video2": {
        "name": "视频2",
        "tooltip": "**第二个视频序列**\n\n• 格式：ComfyUI IMAGE\n• 需要至少 crossfade_frames × 2 帧\n• 必须与 video1 尺寸相同"
      },
      "crossfade_frames": {
        "name": "交叉溶解帧数",
        "tooltip": "**交叉溶解的帧数**\n\n• 默认：10 帧\n• 范围：1-100\n• 值越大，过渡越平滑\n• 推荐：24fps 视频用 10 帧（约 0.4 秒）"
      },
      "enable_crossfade": {
        "name": "启用交叉溶解",
        "tooltip": "**是否启用交叉溶解**\n\n• 默认：True（开启）\n• 开启：在重叠区域进行交叉溶解（g+b+h+e）\n• 关闭：直接拼接，移除 a 和 c（f+b+d+e）"
      }
    },
    "outputs": {
      "0": {
        "name": "合并视频",
        "tooltip": "**拼接后的视频**\n\n• 可以无缝循环播放\n• 如果输入无效，返回 video1"
      },
      "1": {
        "name": "处理报告",
        "tooltip": "**详细处理报告**\n\n包含：\n• 视频分解信息\n• 交叉溶解帧数\n• 输出帧数和顺序\n• 错误信息（如果有）"
      }
    }
  }
}
