{
  "LoopDetectExtract": {
    "display_name": "üîÅ Loop Detect & Extract",
    "description": "**Loop Detection and Extraction Node**\n\nAutomatically detects loop patterns in video frame sequences using advanced FFT autocorrelation analysis.\n\n**Key Features:**\n‚Ä¢ GPU-accelerated processing with automatic memory management\n‚Ä¢ Seam detection for full-loop videos (first-last frame matching)\n‚Ä¢ Motion-based scoring to suppress micro-loops\n‚Ä¢ Multi-factor period selection with length preference\n‚Ä¢ Robust confidence scoring using IQR statistics\n\n**Use Cases:**\n‚Ä¢ Extract perfect loops from long videos\n‚Ä¢ Detect animation cycles\n‚Ä¢ Find repeating motion patterns\n‚Ä¢ Optimize loop start points for seamless playback\n\n**Output:**\n‚Ä¢ Loop segment with optimized boundaries\n‚Ä¢ Detailed analysis report with confidence scores",
    "inputs": {
      "frames": {
        "name": "Input Frames",
        "tooltip": "**Input image sequence** in ComfyUI IMAGE format.\n\n‚Ä¢ Format: (batch, height, width, channels)\n‚Ä¢ Value range: [0, 1] (float)\n‚Ä¢ Minimum: 2 frames required\n‚Ä¢ Recommended: 30+ frames for reliable detection"
      },
      "confidence_threshold": {
        "name": "Confidence Threshold",
        "tooltip": "**Minimum confidence score to accept detected loop**\n\n‚Ä¢ Range: 0.0 - 1.0\n‚Ä¢ Default: 0.55 (balanced)\n‚Ä¢ Lower (0.3-0.4): Accept weaker patterns\n‚Ä¢ Higher (0.6-0.8): Require stronger evidence\n‚Ä¢ If below threshold, returns all frames unchanged\n\n**Interpretation:**\n‚Ä¢ 0.3-0.4: Good loop (minor imperfections)\n‚Ä¢ 0.4-0.5: Excellent loop (high quality)\n‚Ä¢ 0.5+: Perfect loop (rare)"
      },
      "min_period": {
        "name": "Min Period",
        "tooltip": "**Minimum loop period in frames**\n\n‚Ä¢ Default: 24 frames (~1 second at 24fps)\n‚Ä¢ Prevents detection of micro-loops (e.g., 2-8 frame jitter)\n‚Ä¢ Adjust based on your content:\n  - Fast action: 15-20 frames\n  - Normal motion: 24-40 frames\n  - Slow animation: 40-60 frames"
      },
      "max_period": {
        "name": "Max Period",
        "tooltip": "**Maximum loop period in frames**\n\n‚Ä¢ Default: 300 frames (~12 seconds at 24fps)\n‚Ä¢ Should be less than total frame count\n‚Ä¢ Larger values = slower processing\n‚Ä¢ Recommended: N/2 where N is total frames"
      },
      "analysis_stride": {
        "name": "Analysis Stride",
        "tooltip": "**Frame sampling stride for analysis**\n\n‚Ä¢ Default: 2 (analyze every 2nd frame)\n‚Ä¢ Range: 1-8\n‚Ä¢ Lower = More accurate, slower\n‚Ä¢ Higher = Faster, less precise\n\n**Recommendations:**\n‚Ä¢ 1: Maximum accuracy (slow)\n‚Ä¢ 2: Good balance (recommended)\n‚Ä¢ 4: Fast preview mode\n‚Ä¢ 8: Very fast, rough estimate"
      },
      "analysis_size": {
        "name": "Analysis Size",
        "tooltip": "**Target resolution for analysis**\n\n‚Ä¢ Default: 256px\n‚Ä¢ Frames are downscaled to this size for speed\n‚Ä¢ Does NOT affect output quality\n‚Ä¢ Higher = more accurate but slower\n\n**Recommendations:**\n‚Ä¢ 128: Very fast, may miss details\n‚Ä¢ 256: Good balance (recommended)\n‚Ä¢ 384: High accuracy\n‚Ä¢ 512: Maximum detail (slow)"
      },
      "seam_threshold": {
        "name": "Seam Threshold",
        "tooltip": "**First-last frame similarity threshold**\n\n‚Ä¢ Range: 0.0 - 1.0\n‚Ä¢ Default: 0.85 (strict)\n‚Ä¢ Triggers full-loop detection when exceeded\n\n**Use case:**\nDetects videos where the entire sequence forms one loop (e.g., 122-frame rotation that repeats).\n\n‚Ä¢ 0.80: More lenient (minor differences OK)\n‚Ä¢ 0.85: Balanced (recommended)\n‚Ä¢ 0.90: Strict (near-perfect match required)"
      },
      "min_pairs": {
        "name": "Min Sample Pairs",
        "tooltip": "**Minimum sample pairs for statistical reliability**\n\n‚Ä¢ Default: 12\n‚Ä¢ Filters out periods with insufficient data\n‚Ä¢ Higher = more conservative, rejects unstable candidates\n\n**Formula:** pairs = N - period\n‚Ä¢ Short videos: 8-10\n‚Ä¢ Normal videos: 12-16\n‚Ä¢ Long videos: 20-24"
      },
      "prefer_longer_cycles": {
        "name": "Prefer Longer",
        "tooltip": "**Prefer longer periods when scores are close**\n\n‚Ä¢ Default: True (enabled)\n‚Ä¢ Helps avoid micro-loop false positives\n‚Ä¢ When scores differ by < 5%, selects the longer period\n\n**Example:**\n‚Ä¢ 8-frame micro-jitter: score = 0.30\n‚Ä¢ 90-frame real loop: score = 0.28\n‚Üí With this enabled, selects 90-frame loop"
      },
      "length_bias": {
        "name": "Length Bias Strength",
        "tooltip": "**Preference strength for longer periods**\n\n‚Ä¢ Range: 0.0 - 0.2\n‚Ä¢ Default: 0.05 (subtle)\n‚Ä¢ Adds small bonus to longer period scores\n\n‚Ä¢ 0.00: No bias (pure score-based)\n‚Ä¢ 0.05: Subtle preference (recommended)\n‚Ä¢ 0.10: Moderate preference\n‚Ä¢ 0.15+: Strong preference (may miss short loops)"
      },
      "motion_weight": {
        "name": "Motion Weight",
        "tooltip": "**Weight for motion periodicity in scoring**\n\n‚Ä¢ Range: 0.0 - 1.0\n‚Ä¢ Default: 0.25 (25% motion, 75% appearance)\n‚Ä¢ Suppresses static or micro-motion false loops\n\n**How it works:**\nAnalyzes frame-to-frame motion energy:\n‚Ä¢ High motion periodicity = real loop\n‚Ä¢ Low motion = static or jitter\n\n‚Ä¢ 0.0: Appearance only (ignores motion)\n‚Ä¢ 0.25: Balanced (recommended)\n‚Ä¢ 0.5: Equal weight\n‚Ä¢ 0.75+: Motion-dominant"
      }
    },
    "outputs": {
      "0": {
        "name": "Loop Frames",
        "tooltip": "**Detected loop segment**\n\n‚Ä¢ Optimized loop boundaries\n‚Ä¢ Can be directly used for looping playback\n‚Ä¢ If no loop detected, returns all input frames"
      },
      "1": {
        "name": "Loop Start",
        "tooltip": "**Starting frame index of the loop**\n\n‚Ä¢ Zero-based index\n‚Ä¢ 0 = loop starts at first frame\n‚Ä¢ Optimized for minimal seam visibility"
      },
      "2": {
        "name": "Loop Period",
        "tooltip": "**Length of the loop in frames**\n\n‚Ä¢ Number of frames in the detected cycle\n‚Ä¢ Equal to total frames if no loop detected\n‚Ä¢ Use for timing calculations (e.g., period/fps = loop duration)"
      },
      "3": {
        "name": "Confidence",
        "tooltip": "**Loop detection confidence score**\n\n‚Ä¢ Range: 0.0 - 1.0\n‚Ä¢ Higher = stronger loop pattern detected\n\n**Interpretation:**\n‚Ä¢ < 0.3: Weak or no loop\n‚Ä¢ 0.3-0.4: Good loop\n‚Ä¢ 0.4-0.5: Excellent loop\n‚Ä¢ 0.5+: Perfect loop\n‚Ä¢ 0.0: No loop detected (below threshold)"
      },
      "4": {
        "name": "Analysis Report",
        "tooltip": "**Detailed analysis report (text)**\n\nContains:\n‚Ä¢ Detection status and confidence\n‚Ä¢ Loop boundaries (start, period, end)\n‚Ä¢ Top candidate periods with scores\n‚Ä¢ Reason for failure (if not detected)\n‚Ä¢ Seam detection info (if applicable)\n\nUseful for:\n‚Ä¢ Debugging detection issues\n‚Ä¢ Understanding candidate selection\n‚Ä¢ Tuning parameters"
      }
    }
  },
  "VideoFrameExtractor": {
    "display_name": "üìπ Video Frame Extractor",
    "description": "**Video Frame Extractor Node**\n\nExtracts edge frames in reversed order and generates VAE mask and masked video.\n\n**Key Features:**\n‚Ä¢ Extract crossfade segments (reversed order)\n‚Ä¢ Generate continuous white mask regions (for VAE reconstruction)\n‚Ä¢ Support discarding edge frames for VAE reconstruction\n‚Ä¢ Customizable fill color\n\n**Use Cases:**\n‚Ä¢ Optimize loop videos with crossfade\n‚Ä¢ VAE-based video frame reconstruction\n‚Ä¢ Video edge transition optimization",
    "inputs": {
      "frames": {
        "name": "Input Frames",
        "tooltip": "**Input image sequence** in ComfyUI IMAGE format.\n\n‚Ä¢ Format: (batch, height, width, channels)\n‚Ä¢ Value range: [0, 1] (float)"
      },
      "crossfade_frames": {
        "name": "Crossfade Frames",
        "tooltip": "**Number of frames to extract from each edge for crossfade**\n\n‚Ä¢ Default: 10\n‚Ä¢ Range: 0-1000\n‚Ä¢ Output in reversed order (tail first, head last)"
      },
      "mask_frames": {
        "name": "Mask Frames",
        "tooltip": "**Number of frames in middle mask region**\n\n‚Ä¢ Default: 0\n‚Ä¢ Range: 0-1000\n‚Ä¢ Filled with gray, marked for VAE reconstruction"
      },
      "discard_frames": {
        "name": "Discard Frames",
        "tooltip": "**Number of frames to 'eat' from each end of crossfade segments**\n\n‚Ä¢ Default: 0\n‚Ä¢ Range: 0-1000\n‚Ä¢ Removed from both ends of crossfade_frames\n‚Ä¢ Actual original video frames = crossfade - discard\n‚Ä¢ Discarded portions filled with gray for VAE reconstruction"
      },
      "fill_color": {
        "name": "Fill Color",
        "tooltip": "**Fill color (hexadecimal)**\n\n‚Ä¢ Default: #7F7F7F (medium gray)\n‚Ä¢ Format: #RRGGBB\n‚Ä¢ Used for discard and mask regions"
      }
    },
    "outputs": {
      "0": {
        "name": "Head Crossfade",
        "tooltip": "**Head crossfade segment (b)** (original video)\n\n‚Ä¢ Count: crossfade_frames\n‚Ä¢ Used for crossfade"
      },
      "1": {
        "name": "Tail Crossfade",
        "tooltip": "**Tail crossfade segment (d)** (original video)\n\n‚Ä¢ Count: crossfade_frames\n‚Ä¢ Used for crossfade"
      },
      "2": {
        "name": "Middle Segment",
        "tooltip": "**Middle portion (c)** (original video)\n\n‚Ä¢ Not included in mask and masked_video\n‚Ä¢ Original video middle segment"
      },
      "3": {
        "name": "Mask",
        "tooltip": "**VAE Mask**\n\n‚Ä¢ Order: d + e + mask + a + b\n‚Ä¢ Black (0.0): d and b (preserve)\n‚Ä¢ White (1.0): e+mask+a (continuous reconstruction)\n‚Ä¢ Shape: (N, H, W)"
      },
      "4": {
        "name": "Masked Video",
        "tooltip": "**VAE Input Video**\n\n‚Ä¢ Order: d + e + mask + a + b\n‚Ä¢ Original: d and b\n‚Ä¢ Gray: e+mask+a (continuous fill)\n‚Ä¢ Shape: (N, H, W, 3)"
      }
    }
  },
  "LoopVideoCrossfade": {
    "display_name": "üîÑ Loop Video Crossfade",
    "description": "**Loop Video Crossfade Node**\n\nSeamlessly merges two videos using crossfade technique, making the output itself loopable.\n\n**Key Features:**\n‚Ä¢ Intelligent video decomposition and recombination\n‚Ä¢ Smooth crossfade transitions\n‚Ä¢ Seamlessly loopable output\n\n**Use Cases:**\n‚Ä¢ Merge loop video segments\n‚Ä¢ Eliminate loop seams\n‚Ä¢ Create infinite loop animations",
    "inputs": {
      "video1": {
        "name": "Video 1",
        "tooltip": "**First video sequence**\n\n‚Ä¢ Format: ComfyUI IMAGE\n‚Ä¢ Requires at least crossfade_frames √ó 2 frames"
      },
      "video2": {
        "name": "Video 2",
        "tooltip": "**Second video sequence**\n\n‚Ä¢ Format: ComfyUI IMAGE\n‚Ä¢ Requires at least crossfade_frames √ó 2 frames\n‚Ä¢ Must match video1 dimensions"
      },
      "crossfade_frames": {
        "name": "Crossfade Frames",
        "tooltip": "**Number of frames for crossfade**\n\n‚Ä¢ Default: 10 frames\n‚Ä¢ Range: 1-100\n‚Ä¢ Larger values = smoother transitions\n‚Ä¢ Recommended: 10 frames for 24fps (~0.4 seconds)"
      },
      "enable_crossfade": {
        "name": "Enable Crossfade",
        "tooltip": "**Enable crossfade blending**\n\n‚Ä¢ Default: True (enabled)\n‚Ä¢ Enabled: Crossfade in overlap regions (g+b+h+e)\n‚Ä¢ Disabled: Direct concat, remove a and c (f+b+d+e)"
      }
    },
    "outputs": {
      "0": {
        "name": "Merged Video",
        "tooltip": "**Merged video output**\n\n‚Ä¢ Can be looped seamlessly\n‚Ä¢ Returns video1 if inputs are invalid"
      },
      "1": {
        "name": "Report",
        "tooltip": "**Detailed processing report**\n\nContains:\n‚Ä¢ Video decomposition info\n‚Ä¢ Crossfade frame count\n‚Ä¢ Output frame count and order\n‚Ä¢ Error messages (if any)"
      }
    }
  }
}
